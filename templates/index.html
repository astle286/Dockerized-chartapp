<!DOCTYPE html>
<html>
<head>
    <title>ChartApp</title>
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css">
    <link rel="stylesheet" href="{{ url_for('static', filename='styles.css') }}">
    <!-- Font Awesome for dashboard icon -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.0/css/all.min.css">
</head>
<body class="container mt-5 light-theme">

    <!-- Dashboard Button (floating top-left corner) -->
    <div class="dashboard-btn">
        <a href="{{ url_for('dashboard') }}" target="_blank">
            <i class="fas fa-tachometer-alt"></i>
        </a>
    </div>


    <!-- Theme Toggle -->
    <div class="theme-toggle">
        <label class="switch">
            <input type="checkbox" id="themeSwitch">
            <span class="slider"></span>
        </label>
        <span id="themeLabel">Light Mode</span>
    </div>

    <h1 class="mb-4">ChartApp</h1>

    <!-- Upload + Chart Config Form -->
    {% include 'form.html' %}

    <!-- Chart Display -->
    <div class="row mt-4">
        {% if chart_a %}
        <div class="col-md-6">
            <h3>Chart A</h3>
            <div class="border p-3">{{ chart_a|safe }}</div>
        </div>
        {% endif %}
        {% if chart_b %}
        <div class="col-md-6">
            <h3>Chart B</h3>
            <div class="border p-3">{{ chart_b|safe }}</div>
        </div>
        {% endif %}
    </div>

    <!-- Preview Table -->
    {% if preview %}
    <h2 class="mt-5">Data Preview</h2>
    <button class="btn btn-outline-secondary mb-3" id="togglePreview">Show Full Table</button>
    <div class="preview-wrapper border p-3 rounded">
        <!-- Limited Preview -->
        <div id="previewContainerLimited" class="preview-visible">
            {{ preview|safe }}
        </div>

        <!-- Full Table (hidden initially) -->
        <div id="previewContainerFull" class="preview-hidden">
            {{ full_table|safe }}
        </div>
    </div>
    {% endif %}

    <!-- Scripts -->
    <script src="https://code.jquery.com/jquery-3.7.1.min.js"></script>
    <script>
    document.addEventListener("DOMContentLoaded", () => {
        const themeSwitch = document.getElementById('themeSwitch');
        const themeLabel = document.getElementById('themeLabel');
        const body = document.body;

        // Theme toggle
        if (themeSwitch) {
            themeSwitch.addEventListener('change', () => {
                body.classList.toggle('dark-theme', themeSwitch.checked);
                body.classList.toggle('light-theme', !themeSwitch.checked);
                themeLabel.textContent = themeSwitch.checked ? "Dark Mode" : "Light Mode";
            });
        }

        // Preview toggle (limited vs full)
        const toggleBtn = document.getElementById('togglePreview');
        const limited = document.getElementById('previewContainerLimited');
        const full = document.getElementById('previewContainerFull');

        if (toggleBtn && limited && full) {
            toggleBtn.addEventListener('click', () => {
                const showingFull = full.classList.contains('preview-visible');

                if (showingFull) {
                    // Hide full, show limited
                    full.classList.remove('preview-visible');
                    full.classList.add('preview-hidden');
                    limited.classList.remove('preview-hidden');
                    limited.classList.add('preview-visible');
                    toggleBtn.textContent = "Show Full Table";
                } else {
                    // Hide limited, show full
                    limited.classList.remove('preview-visible');
                    limited.classList.add('preview-hidden');
                    full.classList.remove('preview-hidden');
                    full.classList.add('preview-visible');
                    toggleBtn.textContent = "Show Less";
                }
            });
        }
    });
    </script>
</body>
</html>
